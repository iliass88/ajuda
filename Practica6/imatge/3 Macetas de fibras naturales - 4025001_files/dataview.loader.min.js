/*!
 * DataviewLoader
 * 
 * @author nexMart GmbH und Co. KG
 *
 * @callback loadCallback
 * @param {Object|undefined} status
 * @param {string} status.status 'success' in case everything went fine, 'error' in case data View is loaded but something else went wrong (e.g. product not found)
 * @param {string} status.message Error message in case data View is loaded but something else went wrong (e.g. product not found)
 *
 * @callback errorCallback
 * @param {Object|undefined} message Error message
 *
 * @param {object}        element                         - DOM Element to be used as container
 * @param {string}        options.productId               - Product Id (either productId or ean needs to be set!)
 * @param {string}        options.ean                     - Product's ean (either productId or ean needs to be set!)
 * @param {string}        options.supplier                - Product's supplier (optional if ean is set)
 * @param {string}        options.apiKey                  - API Key
 * @param {string}        options.partnerkey              - partnerkey
 * @param {string}        [options.language]              - Language in which the product shall be displayed
 * @param {boolean}       [options.useIFrameResizer=true] - Whether to use iframe-resizer or not (see: https://github.com/davidjbradshaw/iframe-resizer)
 * @param {string}        [options.baseUrl]               - Data View service base URL
 * @param {boolean}       [options.debug=false]           - Enable debug outputs in the console
 * @param {errorCallback} [options.errorCallback]         - Function to be called in case of error.
 * @param {loadCallback}  [options.loadCallback]          - Function to be called when data View is loaded.
 */
function DataviewLoader(e,a){this.container=e;var t=this;this.options={productId:null,ean:null,supplier:null,language:null,partnerkey:null,apiKey:null,useIFrameResizer:!0,baseUrl:"https://www.nexmart.com/api/dataview/",debug:!1,errorCallback:function(){},loadCallback:function(){}};for(var i in a)"object"==typeof a[i]&&null!==a[i]?(this.options[i]=this.options[i]||{},arguments.callee(this.options[i],a[i])):this.options[i]=a[i];this.options.language;if(function(e,a,i,s,o,n,l){l.className=l.className.replace(/dataview-.*/g,""),l.className+=" dataview-loading";var r=t.options.baseUrl+"?";r+="productid=",r+=e||"",r+="&supplier=",r+=i||"",r+="&gtin=",r+=a||"",r+="&lang=",r+=s||"",r+="&apikey=",r+=o||"",r+="&partnerkey=",r+=n||"";var d=document.createElement("IFRAME");d.setAttribute("class","iframe__dataview"),d.setAttribute("frameborder","0"),d.setAttribute("width","100%"),d.setAttribute("height","1000px"),d.style.display="block",l||(l=document.body),l.appendChild(d),"undefined"!=typeof iFrameResize&&t.options.useIFrameResizer?(setTimeout(function(){t.options.debug&&console.log("dataView timed out"),l.className.indexOf(/dataview-loading/g)>0&&("function"==typeof t.options.loadCallback&&t.options.loadCallback.call(t.container,{status:data.message.status,message:data.message.msg}),l.className=l.className.replace(/dataview-loading/g,"dataview-loaded"))},5e3),d.setAttribute("scrolling","no"),iFrameResize({log:!1,enablePublicMethods:!0,checkOrigin:!1,messageCallback:function(e){t.options.debug&&console.log("dataView loaded"),"function"==typeof t.options.loadCallback&&t.options.loadCallback.call(t.container,{status:e.message.status,message:e.message.msg}),l.className=l.className.replace(/dataview-loading/g,"dataview-loaded"),"success"==e.message.status?d.style.display="":(t.options.debug&&console.log("ERROR: "+e.message.msg),"function"==typeof t.options.errorCallback&&t.options.errorCallback.call(t.container,e.message.msg))}},d)):d.onload=function(){t.options.debug&&console.log("iframe loaded"),"function"==typeof t.options.loadCallback&&t.options.loadCallback.call(t.container),d.style.display=""},d.onerror=function(){"function"==typeof t.options.errorCallback&&t.options.errorCallback.call(t.container)},d.setAttribute("src",r)}(this.options.productId,this.options.ean,this.options.supplier,this.options.language,this.options.apiKey,this.options.partnerkey,this.container),t.options.debug){var s="DataviewLoader initialized with options:";s+="\n  productId="+this.options.productId,s+="\n  ean="+this.options.ean,s+="\n  supplier="+this.options.supplier,s+="\n  language="+this.options.language,s+="\n  apiKey="+this.options.apiKey,s+="\n  partnerkey="+this.options.partnerkey,s+="\n  useIFrameResizer="+this.options.useIFrameResizer,s+="\n  debug="+this.options.debug,s+="\nversion: "+window.dataviewLoaderVersion,console.log(s)}}window.dataviewLoaderVersion="1.3.0","undefined"!=typeof jQuery&&function(e){e.fn.dataview=function(a){return this.each(function(){var t=(e(this),this.dataset.dataviewProduct),i=this.dataset.dataviewEan,s=this.dataset.dataviewSupplier,o=this.dataset.dataviewLanguage||"deu",n=this.dataset.dataviewPartnerkey,l=this.dataset.dataviewApiKey,r=this.dataset.dataviewBaseurl||"https://www.nexmart.com/api/dataview/";new DataviewLoader(this,e.extend({},{productId:t,ean:i,supplier:s,language:o,apiKey:l,partnerkey:n,baseUrl:r},a))})}}(jQuery);